# bits 相关 mcp

## 查询 bits， devops， task， 代码评审

url：https://bits.bytedance.net/api/v1/dev/task/changes

params:

```shell
params = {
    "devBasicId": 1862036
}
```

header:

```shell
headers = {
    "x-jwt-token": "",
    "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36 Edg/142.0.0.0",
    "Accept": "application/json, text/plain, */*",
    "Accept-Language": "zh-CN,zh;q=0.9,en;q=0.8",
    "Accept-Encoding": "gzip, deflate, br, zstd"
}

```

resp:

```json
{
  "code": 200,
  "message": "ok",
  "data": {
    "changeList": [
      {
        "change": {
          "id": 2841927,
          "changeType": "CHANGE_TYPE_CODE",
          "creator": "maifeng",
          "manifest": {
            "codeElement": {
              "sourceBranch": "feat_promotion_diff",
              "targetBranch": "master",
              "title": "feat: [development task] 秒杀新旧架构支持双写链路 (1862036)",
              "url": "https://bits.bytedance.net/code/oec/affiliate_streamer_api/merge_requests/1285",
              "status": "opened",
              "creator": "maifeng",
              "repoPath": "oec/affiliate_streamer_api",
              "hostingPlatform": "gitlab",
              "codeChangeId": 1565150,
              "repoId": 260351,
              "checkoutFrom": "",
              "lastestCommit": {
                "id": "105492741cc6ac4e47b0d73865a55ed91840df8e",
                "short_id": "10549274",
                "title": "采样总开关\n"
              },
              "codebaseRepoId": 287717,
              "iid": 1285,
              "codebaseChangeId": 743327462885201,
              "isCodebaseDraft": false
            }
          },
          "deployConfigs": [
            {
              "projectInfo": {
                "id": 0,
                "type": "PROJECT_TYPE_TCE",
                "name": "oec.affiliate.streamer_api",
                "psm": "oec.affiliate.streamer_api",
                "projectUniqueId": "oec.affiliate.streamer_api",
                "scmDependencyVersionChoice": "latest",
                "enableScmBranch": false
              },
              "buildConfigs": [
                {
                  "scmDependencies": [
                    {
                      "id": 667,
                      "name": "toutiao/load",
                      "isMain": false,
                      "pubBase": "SCM_PUB_BASE_VERSION",
                      "revision": "",
                      "gitRepoName": "toutiao/load",
                      "commitId": "",
                      "overrideIntegrationScmVersion": false,
                      "gitRepoId": 503623,
                      "devMode": "Version",
                      "checkoutFrom": "",
                      "useLatest": true
                    },
                    {
                      "id": 631,
                      "name": "toutiao/runtime",
                      "isMain": false,
                      "pubBase": "SCM_PUB_BASE_VERSION",
                      "revision": "",
                      "gitRepoName": "toutiao/runtime",
                      "commitId": "",
                      "overrideIntegrationScmVersion": false,
                      "gitRepoId": 503626,
                      "devMode": "Version",
                      "checkoutFrom": "",
                      "useLatest": true
                    },
                    {
                      "id": 146542,
                      "name": "oec/affiliate/streamer_api",
                      "isMain": true,
                      "pubBase": "SCM_PUB_BASE_BRANCH",
                      "revision": "feat_promotion_diff",
                      "gitRepoName": "oec/affiliate_streamer_api",
                      "commitId": "105492741cc6ac4e47b0d73865a55ed91840df8e",
                      "overrideIntegrationScmVersion": false,
                      "gitRepoId": 260351,
                      "devMode": "CodeChange",
                      "checkoutFrom": "",
                      "useLatest": false
                    }
                  ],
                  "controlPanel": "CONTROL_PLANE_I18N",
                  "withoutChange": false
                },
                {
                  "scmDependencies": [
                    {
                      "id": 631,
                      "name": "toutiao/runtime",
                      "isMain": false,
                      "pubBase": "SCM_PUB_BASE_VERSION",
                      "revision": "",
                      "gitRepoName": "toutiao/runtime",
                      "commitId": "",
                      "overrideIntegrationScmVersion": false,
                      "gitRepoId": 503626,
                      "devMode": "Version",
                      "checkoutFrom": "",
                      "useLatest": true
                    },
                    {
                      "id": 667,
                      "name": "toutiao/load",
                      "isMain": false,
                      "pubBase": "SCM_PUB_BASE_VERSION",
                      "revision": "",
                      "gitRepoName": "toutiao/load",
                      "commitId": "",
                      "overrideIntegrationScmVersion": false,
                      "gitRepoId": 503623,
                      "devMode": "Version",
                      "checkoutFrom": "",
                      "useLatest": true
                    },
                    {
                      "id": 146542,
                      "name": "oec/affiliate/streamer_api",
                      "isMain": true,
                      "pubBase": "SCM_PUB_BASE_BRANCH",
                      "revision": "feat_promotion_diff",
                      "gitRepoName": "oec/affiliate_streamer_api",
                      "commitId": "105492741cc6ac4e47b0d73865a55ed91840df8e",
                      "overrideIntegrationScmVersion": false,
                      "gitRepoId": 260351,
                      "devMode": "CodeChange",
                      "checkoutFrom": "",
                      "useLatest": false
                    }
                  ],
                  "controlPanel": "CONTROL_PLANE_EU_TTP",
                  "withoutChange": false
                },
                {
                  "scmDependencies": [
                    {
                      "id": 631,
                      "name": "toutiao/runtime",
                      "isMain": false,
                      "pubBase": "SCM_PUB_BASE_VERSION",
                      "revision": "",
                      "gitRepoName": "toutiao/runtime",
                      "commitId": "",
                      "overrideIntegrationScmVersion": false,
                      "gitRepoId": 503626,
                      "devMode": "Version",
                      "checkoutFrom": "",
                      "useLatest": true
                    },
                    {
                      "id": 667,
                      "name": "toutiao/load",
                      "isMain": false,
                      "pubBase": "SCM_PUB_BASE_VERSION",
                      "revision": "",
                      "gitRepoName": "toutiao/load",
                      "commitId": "",
                      "overrideIntegrationScmVersion": false,
                      "gitRepoId": 503623,
                      "devMode": "Version",
                      "checkoutFrom": "",
                      "useLatest": true
                    },
                    {
                      "id": 146542,
                      "name": "oec/affiliate/streamer_api",
                      "isMain": true,
                      "pubBase": "SCM_PUB_BASE_BRANCH",
                      "revision": "feat_promotion_diff",
                      "gitRepoName": "oec/affiliate_streamer_api",
                      "commitId": "105492741cc6ac4e47b0d73865a55ed91840df8e",
                      "overrideIntegrationScmVersion": false,
                      "gitRepoId": 260351,
                      "devMode": "CodeChange",
                      "checkoutFrom": "",
                      "useLatest": false
                    }
                  ],
                  "controlPanel": "CONTROL_PLANE_US_TTP",
                  "withoutChange": false
                }
              ],
              "deployDependencies": [],
              "owner": "maifeng"
            }
          ],
          "status": "opened",
          "title": "oec/affiliate_streamer_api",
          "createAt": 1763975746000,
          "isDraft": false
        },
        "diffCount": {
          "deletions": 56,
          "insertions": 593
        },
        "commentCount": 2,
        "checkInfo": {
          "status": "succeeded"
        },
        "reviewInfo": {
          "reviewersInfo": [
            {
              "username": "franklin",
              "status": "RUNNING"
            },
            {
              "username": "ci_tt_code_ai",
              "status": "RUNNING"
            }
          ],
          "reviewStatus": "RUNNING",
          "reviewerCount": {
            "total": 2,
            "passNumber": 0,
            "rejectionNumber": 0
          },
          "reviewRules": {
            "approvals": [
              {
                "approvers": [],
                "reviewRule": {
                  "ruleType": "",
                  "name": "default",
                  "approvalsRequired": 1,
                  "users": [],
                  "groups": []
                }
              },
              {
                "approvers": [],
                "reviewRule": {
                  "ruleType": "",
                  "name": "default",
                  "approvalsRequired": 1,
                  "users": [],
                  "groups": []
                }
              }
            ],
            "disapprovers": [],
            "status": "Pending"
          },
          "skipped": false
        },
        "stateInfo": {
          "isConflicted": false,
          "conflictResolveUrl": "",
          "commitDiverging": {
            "behindCount": 0,
            "aheadCount": 14
          }
        },
        "mergeRule": {
          "enableSquashCommit": false,
          "commitMessage": "",
          "enableRemoveSourceBranch": true,
          "mergeStrategy": "",
          "mergeMethod": "merge_commit",
          "mergeCommitMessage": "Merge branch 'feat_promotion_diff' into 'master'\n\n秒杀新旧架构支持双写链路\n\nAuthor: maifeng (maifeng@bytedance.com)\nUrl: https://bits.bytedance.net/devops/201141148930/develop/developmentTask/detail/1862036\nProjectId: 260351\nIid: 1285\nRepoPath: oec/affiliate_streamer_api\nSquash Message: "
        }
      }
    ]
  }
}
```

通过这个 resp， 目前我们比较关心的字段，首先注意 changeList 是个数字，可能会有多个仓库任务：

1. changes
   1. id: taskid
   2. creator：开发者
   3. title：仓库名称
   4. manifest：代码变更详情
      1. codeElement：变更的代码详情（每个信息都特别重要）
2. diffCount
3. commentCount
