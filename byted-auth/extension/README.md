# ByteDance SSO Auth Capture - Browser Extension

这是一个浏览器扩展，用于从ByteDance SSO登录页面提取`CAS_SESSION` cookie，支持按区域（CN/US/I18N）选择。

## 功能特点

- 🌍 **多区域支持**: CN/US/I18N 三个区域
- 🎯 **智能区域识别**: 自动检测当前页面所属区域并高亮对应按钮
- 🔒 **安全提取**: 仅提取`CAS_SESSION` cookie，不收集其他敏感信息
- 📋 **一键复制**: 快速复制提取的cookie值
- 🎨 **友好界面**: 简洁直观的用户界面
- 🔧 **权限最小化**: 仅申请必要的权限

## 安装方法

### 开发者模式安装

1. **下载扩展文件**
   ```bash
   # 确保您已经克隆了包含扩展文件的仓库
   cd extension/
   ```

2. **打开Chrome扩展管理页面**
   - 在Chrome地址栏输入: `chrome://extensions/`
   - 或者通过菜单: 设置 → 更多工具 → 扩展程序

3. **启用开发者模式**
   - 在右上角打开"开发者模式"开关

4. **加载扩展**
   - 点击"加载已解压的扩展程序"按钮
   - 选择`extension`文件夹
   - 扩展图标将出现在浏览器工具栏

### 文件结构
```
extension/
├── manifest.json          # 扩展配置文件
├── background.js          # 后台服务脚本
├── popup.html            # 弹出界面
├── popup.js              # 弹出界面脚本
├── offscreen.html        # 离屏文档（剪贴板备用）
├── offscreen.js          # 离屏文档脚本
├── icons/                # 扩展图标
│   ├── icon16.png
│   ├── icon32.png
│   └── icon128.png
└── README.md             # 本文件
```

## 使用方法

1. **首次使用**
   - 点击扩展图标，弹出窗口显示当前页面状态
   - 如果当前页面不是SSO页面，点击区域按钮（CN/US/I18N）
   - 扩展将在新标签页打开对应区域的SSO登录页面

2. **完成SSO登录**
   - 在新打开的SSO页面完成正常的登录流程
   - 登录完成后，保持该页面打开

3. **提取CAS_SESSION**
   - 再次点击扩展图标（确保当前标签页是SSO页面）
   - 扩展检测到当前页面是SSO页面，点击区域按钮直接提取cookie
   - 提取的`CAS_SESSION`值将显示在结果区域

5. **复制cookie**
   - 点击"Copy to Clipboard"按钮复制cookie值
   - 成功复制后会显示确认消息

### 使用流程图
```
首次点击扩展 → 选择区域 → 新标签页打开SSO → 用户登录 → 再次点击扩展 → 提取cookie → 一键复制
```

## 区域映射

| 区域 | 域名 | 登录URL |
|------|------|---------|
| CN | `.bytedance.net` | `https://cloud.bytedance.net/auth/api/v1/login` |
| US | `.bytedance.net` | `https://cloud-ttp-us.bytedance.net/auth/api/v1/login` |
| I18N | `.bytedance.net` | `https://cloud-i18n.bytedance.net/auth/api/v1/login` |

## 技术实现

### 权限说明
- `cookies`: 读取指定域名的cookie
- `activeTab`: 获取当前标签页信息
- `host_permissions`: 访问ByteDance域名下的页面

### 核心功能
1. **智能页面检测**: 自动检测当前页面是否为SSO登录页
2. **条件跳转**: 仅在需要时新开标签页跳转到SSO登录页
3. **直接提取**: 在SSO页面可直接提取CAS_SESSION，无需后台监控
4. **Cookie提取**: 使用`chrome.cookies.getAll()` API读取cookie
5. **消息通信**: 前后台脚本通过`chrome.runtime.sendMessage()`通信
6. **剪贴板操作**: 支持现代Clipboard API和降级方案
7. **状态管理**: 保存用户最后选择的区域偏好

### 安全考虑
- 仅提取`CAS_SESSION` cookie，不收集其他敏感信息
- 不向外部网络发送任何数据
- 所有操作都在本地完成
- 权限申请最小化，仅申请必要权限

## 故障排除

### 常见问题

1. **扩展无法跳转或提取cookie**
   - 检查是否已授予扩展必要的权限
   - 确保浏览器允许扩展访问cookie和创建标签页
   - 确认当前页面URL包含bytedance相关域名
   - 尝试重新加载扩展

2. **在SSO页面点击区域按钮无反应**
   - 确保您已在该页面完成登录
   - 检查浏览器控制台是否有错误信息
   - 确认页面域名与选择的区域匹配
   - 尝试刷新页面后重试

3. **复制功能失败**
   - 某些浏览器可能限制剪贴板访问
   - 扩展会自动使用备用方案
   - 手动选择并复制显示的文本

4. **区域按钮无响应**
   - 检查浏览器控制台是否有错误信息
   - 确保扩展已正确加载
   - 尝试重新加载扩展

### 调试方法

1. **查看扩展日志**
   - 打开`chrome://extensions/`
   - 找到本扩展的"背景页"链接
   - 点击打开开发者工具查看日志

2. **检查权限**
   - 在扩展详情页查看已授予的权限
   - 确保所有必要权限都已启用

## 更新日志

### v1.1.0 (当前版本)
- 🧠 **智能页面检测**: 自动识别当前页面是否为SSO登录页
- 🎯 **智能区域识别**: 自动检测当前SSO页面所属区域并高亮对应按钮
- 🚀 **条件跳转逻辑**: 仅在需要时新开标签页，避免重复跳转
- 🎯 **简化交互流程**: 去除后台监控，用户主动控制提取时机
- ⚡ **响应更迅速**: 直接在SSO页面提取，无需等待监控

### v1.0.0
- ✨ 初始版本发布
- 🌍 支持CN/US/I18N三个区域
- 📋 一键复制功能
- 🎨 现代化UI设计

## 贡献

欢迎提交Issue和Pull Request来改进这个扩展。

## 许可证

此扩展仅供ByteDance内部使用。